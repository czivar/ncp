<!doctype html>
<html xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <title>ESnet6 utilization projection visualization</title>

    <script th:src="@{/webjars/jquery/1.12.4/jquery.min.js}"></script>
    <script type="text/javascript" src="/vis/vis.js"></script>
    <link href="/vis/vis.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="/my.js"></script>

    <style type="text/css">
        #mynetwork {
            border: 1px solid lightgray;
        }
    </style>
</head>

<body>

<div>
    <a href="/">Datasets</a>
</div>

<div id="mynetwork"></div>

<div id="positions_display"></div>

<form class="form-inline" id="positions_form">
    <button type="submit" class="btn btn-primary">Dump positions</button>
</form>


<script type="text/javascript" th:inline="javascript">
    var network;

    loadJSON([[${util_url}]], function (response) {
        /*<![CDATA[*/
        // need CDATA for lt , gt
        // Parse JSON string into object
        var mydata = JSON.parse(response);
        var height = 700;
        var options = {
            height: height + 'px',
            interaction: {
                zoomView: true,
                dragView: true,
                hideEdgesOnDrag: false
            },
            physics: {
                stabilization: true
            },
            nodes: {
                shape: 'dot'
            },
            edges: {}
        };

        // create an array with nodes
        var nodes = new vis.DataSet(mydata['nodes']);
        var edges = new vis.DataSet(mydata['edges']);


        // create a network
        var container = document.getElementById('mynetwork');
        var data = {
            nodes: nodes,
            edges: edges
        };
        network = new vis.Network(container, data, options);

        network.on('dragEnd', function (params) {
            for (var i = 0; i < params.nodes.length; i++) {
                var nodeId = params.nodes[i];
                nodes.update({id: nodeId, fixed: {x: true, y: true} });
            }
        });

        network.on('dragStart', function(params) {
            for (var i = 0; i < params.nodes.length; i++) {
                var nodeId = params.nodes[i];
                nodes.update({id: nodeId, fixed: {x: false, y: false} });
            }
        });
        /*]]>*/
    });

    $('#positions_form').on('submit', function (e) {
        e.preventDefault();
        var pos = network.getPositions();
        var jsonText = JSON.stringify(pos, null);
        $('#positions_display').text(jsonText);
        return false;

    });
    $('#positions_form').hide();

</script>




</body>
</html>
